# @reference
# https://qiita.com/toshipon/items/2a1513b584650dcd81c1
# https://qiita.com/suupia/items/f5e08faeedffb18efbf2
#

name: Discord Message Notify

on:
  push:
    branches: [ webhook-test ]
  pull_request:
    branches: [ webhook-test ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
 
    - name: Check out repo's head branch
      uses: actions/checkout@v2.4.0
      with:
          ref: ${{ github.head_ref }} #For pull_request events, GITHUB_REF contains the merge branch (refs/pull/:prNumber/merge).

    - name: Get commit message
      run: |
        echo "Commit_Message=$(git log --pretty=oneline --all --abbrev-commit)" >> $GITHUB_ENV
  
    - name: Discord Message Notify
      uses: appleboy/discord-action@0.0.3
      with:
        webhook_id: ${{ secrets.WEBHOOK_ID }}
        webhook_token: ${{ secrets.WEBHOOK_TOKEN }}
        color: "#48f442"
        username: "GitHub Bot"
        args: >
          ${{ github.ref_name }}\n
          @${{ github.actor }} さんが ${{ github.event_name }} しました\n
          ${{ env.Commit_Message }}\n
          ${{ if github.event_name == 'pull_request' }} ${{ github.event.pull_request.html_url }} ${{ else }} ${{ github.event.compare }} ${{ endif }}
